<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Serverlessで行こう</title>
    <link rel="stylesheet" type="text/css" href="build/build.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.6/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome-animation/0.0.10/font-awesome-animation.css">
  </head>
  <body>
    <article class="deck">
      <section>
        <h2>Serverlessで行こう</h2>
        <h4>2018/5/xx</h4>
      </section>
      <section>
        <h2>自己紹介</h2>
        <ul class="build build-items">
          <li>寺原　歩</li>
          <li><a href="https://www.is-tech.co.jp/"><image src="images/ist_logo.png" /></a><br/>の技術戦略推進部<br/><br/></li>
          <li><h3>最近こんなアイコン使ってます<br /><image src="images/27805556.png" height="150" width="150"/></h3></li>
        </ul>
      </section>
      <section>
        <h1>Whats Serverless?</h1>
      </section>
      <section>
        <h2><s>サーバを持たない</s></h2>
        <h4>↑良く言われがち<br/><br/><br/><br/></h4>
        <h2>サーバを管理しない</h2>
      </section>
      <section><blockquote class="twitter-tweet" data-lang="ja"><p lang="en" dir="ltr">If your PaaS can efficiently start instances in 20ms that run for half a second, then call it serverless. <a href="https://t.co/S3YzvqFYLR">https://t.co/S3YzvqFYLR</a></p>&mdash; adrian cockcroft (@adrianco) <a href="https://twitter.com/adrianco/status/736553530689998848">2016年5月28日</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </section>
      <section>
        <h2>あどりあん曰く、</h2><p><i class="fab fa-jenkins fa-2x"></i></p>「もしそのPaaSが、0.5秒実行するインスタンスを20ミリ秒以下で効率的に起動できるのなら、それをサーバレスと呼ぶ。」
      </section>
      <section>
        <h1>Whats Serverless?</h1>
      </section>
      <section>
        <h2><a href="https://knowledge.is-tech.co.jp/knowledge/open.knowledge/view/20">knowledge#20</a> を見よう<br/></h2><p><i class="fas fa-bomb fa-5x faa-tada animated" style="color: red"></i></p>
      </section>
      <section>
        <h2>一般的には</h2>
        <ul class="build build-items">
          <li><h3>AWS Lambda</h3><img src="images/lambda_icon.png"></li>
          <li><h3>Azure Functions</h3><img src="images/azure_functions.png"></li>
          <li><h3>この辺を使ってれば大体Serverlessです。</h2></li>
        </ul>
      </section>
      <section>
        <h2>本題</h2>
        <h3>実際にServerlessでWebAPIを作ってみよう</h3>
      </section>
      <section>
        <h2>ServerlessFrameworkを使う</h2>
        <h3>in AWS × nodejs</h3>
        <pre><code class="language-javascript">// nodeとnpm入っている前提
npm install -g serverless
serverless create --template aws-nodejs --path my-service
cd ./my-service
</code></pre>
      </section>
      <section>
        <h2>AWSで動かす</h2>
        <ul class="build build-items">
          <li><s>serverless deploy -v</s></li>
          <li>残念ながらAWSアカウント持っていないので・・・。</li>
        </ul>
      </section>
      <section>
        <h2>Localで動かす</h2>
        <h3>serverless-offlineを使う</h3>
        <pre><code class="language-bash">npm install serverless-offline --save-dev
</code></pre>
      </section>
      <section>
        <h2>Localで動かす</h2>
        <h3>serverless.ymlに下記の定義を添えてあげる</h3>
        <pre><code class="language-javascript">plugins:
  - serverless-offline

functions:
  hello:
    handler: handler.hello
    events:
      - http:
          method: GET
          path: hello
</code></pre>
      </section>
      <section>
        <h2>Localで動かす</h2>
        <h3>起動コマンドを実行</h3>
        <pre><code class="language-javascript">serverless offline start
</code></pre>
      </section>
      <section>
        <h2>今こんな感じ</h2><img src="images/initial_conposition.png">
      </section>
      <section>
        <h1>超簡単！正味５分</h1>
        <ul class="build build-items">
          <li><h3>だけだとちょっと物足りないので</h3></li>
        </ul>
      </section>
      <section>
        <h2>ちょっと発展</h2>
        <h3>更に子Lambdaを繋ぎたい</h3><img src="images/plus_lambda.png" height="300" width="450">
      </section>
      <section>
        <h3>serverless.ymlにhow-do-you-doを追加</h3>
        <pre><code class="language-javascript">functions:
  howDoYouDo:
    handler: handler.howDoYouDo
</code></pre>
      </section>
      <section>
        <h3>handler.jsにhowDoYouDo関数を追加</h3>
        <pre><code class="language-javascript">const howDoYouDo = (event, context, callback) =>
  callback(null, { message: "how do you do?" });
</code></pre>
      </section>
      <section>
        <h3>hellowがhowDoYouDo関数を呼び出す in handler.js</h3>
        <pre><code class="language-javascript">const hello = (event, context, callback) => {
  const responseForHowDoYouDo =
    process.env.IS_LOCAL || process.env.IS_OFFLINE ?
    howDoYouDo(event, context, (err, data) => data) :
    lambda.invokeAsync({FunctionName: 'howDoYouDo'},
      (err, data) => data
    );

  const response = {
    statusCode: 200,
    body: JSON.stringify({
      message: `hello!  ${responseForHowDoYouDo.message}`
    }),
  };

  callback(null, response);
};
</code></pre>
      </section>
      <section>
        <h3>もうひと手間 in handler.js</h3>
        <pre><code class="language-javascript">// 行頭に・・・
const AWS = require('aws-sdk');
const lambda = new AWS.Lambda();
// 行末に・・・
module.exports = {
  hello,
  howDoYouDo
}
</code></pre>
      </section>
      <section>
        <h3>aws-sdkをinstallして...
          <pre><code class="language-javascript">npm install --save aws-sdk

</code></pre>
        </h3>
      </section>
      <section>
        <h3>完成</h3><img src="images/plus_lambda.png" height="300" width="450">
      </section>
      <section>
        <h3>他にも、、、DynamoDBやマネージメントサービス各種を繋げることが可能</h3><img src="images/add_dynamo.png">
      </section>
      <section>
        <h2>Serverlessで行こう<br/><br/></h2>
        <h2>おしまい</h2>
      </section>
    </article>
    <script src="build/build.js"></script>
  </body>
</html>